<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Collatz Conjecture</title>
  <style>
    body {
      background-color: #222831;
      color: #ffffff;
      font-family: Arial, sans-serif;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    input, button {
      font-size: 1.2rem;
      padding: 12px 20px;
      margin: 10px;
      border-radius: 5px;
      border: 1px solid #000000;
      background-color: #ffffff;
      color: #000000;
      max-width: 400px;
      width: 100%;
      box-sizing: border-box;
    }

    pre#textelem {
      background-color: #ffffff;
      color: #000000;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 600px;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    table {
      margin-top: 30px;
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
    }

    th, td {
      border: 1px solid #ffffff;
      padding: 12px;
      text-align: center;
      background-color: #393e46;
    }

    th {
      background-color: #00adb5;
    }
  </style>
</head>
<body>
  <input type="text" id="userin" placeholder="Enter a number" />
  <button onclick="start()">Start</button>
  <pre id="textelem"></pre>

  <h2>Leaderboard</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Start Number</th>
        <th>Max Number</th>
        <th>Total Steps</th>
      </tr>
    </thead>
    <tbody id="leaderboard-body"></tbody>
  </table>
  <button id="reset-btn" onclick="resetLeaderboard()">Reset Leaderboard</button>

  <script>
    // Word to number converter with support for mixed input like "8 million"
    function wordsToNumber(text) {
      if (!text || typeof text !== 'string') return NaN;

      const ones = {
        zero: 0, one: 1, two: 2, three: 3, four: 4,
        five: 5, six: 6, seven: 7, eight: 8, nine: 9
      };

      const teens = {
        ten: 10, eleven: 11, twelve: 12, thirteen: 13, fourteen: 14,
        fifteen: 15, sixteen: 16, seventeen: 17, eighteen: 18, nineteen: 19
      };

      const tens = {
        twenty: 20, thirty: 30, forty: 40, fifty: 50,
        sixty: 60, seventy: 70, eighty: 80, ninety: 90
      };

      const scales = {
        hundred: 100,
        thousand: 1000,
        million: 1000000
      };

      text = text.toLowerCase().replace(/-/g, ' ').trim();
      const words = text.split(/\s+/);

      let current = 0;
      let total = 0;

      for (let i = 0; i < words.length; i++) {
        const word = words[i];
        const num = parseInt(word);

        if (!isNaN(num)) {
          let multiplier = 1;
          const nextWord = words[i + 1];

          if (scales[nextWord]) {
            multiplier = scales[nextWord];
            i++; // Skip the next word
          }

          total += num * multiplier;
        } else if (ones[word] !== undefined) {
          current += ones[word];
        } else if (teens[word] !== undefined) {
          current += teens[word];
        } else if (tens[word] !== undefined) {
          current += tens[word];
        } else if (word === "hundred") {
          current *= 100;
        } else if (scales[word]) {
          current *= scales[word];
          total += current;
          current = 0;
        } else if (word === "and") {
          continue;
        } else {
          return NaN;
        }
      }

      return total + current;
    }

    // Leaderboard setup
    let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];

    function saveLeaderboardToStorage() {
      localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
    }

    function updateLeaderboardDisplay() {
      const tableBody = document.getElementById('leaderboard-body');
      tableBody.innerHTML = '';

      leaderboard.slice(0, 5).forEach((entry, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${entry.start}</td>
          <td>${entry.max}</td>
          <td>${entry.steps}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Conjecture logic
    function conjecture(n) {
      let result = n + '\n';
      let counter = 0;
      let maxInSequence = n;
      let original = n;

      while (n !== 1) {
        if (n % 2 === 0) {
          n /= 2;
        } else {
          n = n * 3 + 1;
        }
        result += n + '\n';
        counter += 1;
        if (n > maxInSequence) maxInSequence = n;
      }

      leaderboard.push({ start: original, max: maxInSequence, steps: counter });

      leaderboard.sort((a, b) => {
        if (b.steps === a.steps) return b.max - a.max;
        return b.steps - a.steps;
      });

      leaderboard = leaderboard.filter((entry, index, self) =>
        index === self.findIndex(e => e.start === entry.start)
      ).slice(0, 5);

      saveLeaderboardToStorage();
      updateLeaderboardDisplay();

      result += 'conjecture finished!\nTotal steps: ' + counter;
      return result;
    }

    // Start logic
    function start() {
      const rawInput = document.getElementById('userin').value;
      let userinput = parseInt(rawInput);

      if (isNaN(userinput)) {
        userinput = wordsToNumber(rawInput);
      }

      const output = document.getElementById('textelem');
      if (isNaN(userinput) || userinput < 1) {
        output.textContent = 'Please enter a valid positive number!';
        return;
      }

      output.textContent = conjecture(userinput);
    }

    // Reset button with double press
    let resetPending = false;
    function resetLeaderboard() {
      const btn = document.getElementById('reset-btn');

      if (!resetPending) {
        btn.textContent = "Click again to confirm reset";
        resetPending = true;
        setTimeout(() => {
          btn.textContent = "Reset Leaderboard";
          resetPending = false;
        }, 5000);
      } else {
        leaderboard = [];
        saveLeaderboardToStorage();
        updateLeaderboardDisplay();
        btn.textContent = "Reset Leaderboard";
        resetPending = false;
      }
    }

    updateLeaderboardDisplay(); // Initialize leaderboard on load
  </script>
</body>
</html>